<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body class="text-center">
    <div class="d-flex justify-content-start" style="margin-left: 300px; margin-bottom: 100px;">
        <a class="navbar-brand" href="#"><img class="logo mt-3" style="width:50px;" src="./source/img/TRaM_logo.png"
                alt="이미지" id="logoMain"></a>
    </div>
    <div class="container">
        <div class="border w-50 form-control" style="margin-left: 24%;">
            <h3 class="p-2 m-5">로그인</h3>
            <div class="row p-2 input-form-box">
                <input id="userID" type="email" placeholder="이메일" class="p-2 form-control w-50"
                    style="margin-left: 25%;">
            </div>
            <div class="row p-2 input-form-box">
                <input id="userPW" type="password" placeholder="비밀번호" class="p-2 form-control w-50"
                    style="margin-left: 25%">
            </div>

            <div class="m-3">
                <span class="p-2"><button id="signup" type="button">회원가입</button></span>
                <span class="p-2"><button id="find" type="button">아이디 찾기</button></span>
            </div>
            <div class="">
                <button style="width: 100px; height: 50px;" id="login">로그인</button>
            </div>
            <div class="mt-3">
                <div id="naver_id_login"></div>
            </div>
        </div>
    </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
<script src="./source/out_link/Util.js"></script>
<script type="text/javascript" src="https://static.nid.naver.com/js/naverLogin_implicit-1.0.3.js" charset="utf-8">
</script>
<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript">
    // TODO 네이버 간편로그인 팝업창 안 뜨고 로그인 시키기
    // TODO 간편로그인 시 로그인/로그아웃 버튼 상태 변경
    var naver_id_login = new naver_id_login("QPJAZvitp4r_uyBekVmj", "http://192.168.0.175:5500/1_HTML/1_main.html"); //네이버 아이디로 로그인객체 생성후 초기화
    var state = "";
    state = naver_id_login.getUniqState(); //상태 정보를 가져와서 변수 state에 저장 로그인 상태를 유지하기 위함
    naver_id_login.setButton("green", 1, 40); //버튼 색 , 타입, 크기
    naver_id_login.setDomain("http://192.168.0.175:5500/1_HTML/2_login.html");
    naver_id_login.setState(state);
    console.log(`상태값 : ${state}`);
    naver_id_login.init_naver_id_login(); // 네이버 아이디로 로그인을 초기화하고 실행
</script>
<script>
    // page 로딩 완료 시 무조건 admin 계정 생성
    // User_no = 0 에 admin 고정
    let userNum = 0;        // 사용자 정보 PK
    let ReservationNum = 0; // 예약 정보 PK
    let PaymentNum = 0;     // 결제 정보 PK
    let ReviewBoard = 0;    // 리뷰 정보 PK

    document.addEventListener("DOMContentLoaded", function () {
        // 최초 실행 시에만 관리자 계정 생성
        // TODO java script 형태로 Reservation, Payment, ReviewBoard key 값 생성해넣기
        let check = JSON.parse(localStorage.getItem("TRaM"));

        if (check == null) {
            const firstAdminData = {
                "Users": [{
                    "User_no": userNum++
                    , "User_id": "admin"
                    , "User_pw": "admin"
                    , "User_nickName": "관리자"
                    , "User_phone": "none"
                    , "User_status": "Y"
                    , "User_type": "A"
                }]
            };
            localStorage.setItem("TRaM", JSON.stringify(firstAdminData));
        }
    })

    // 로그인화면
    const find = document.querySelector("#find");
    find.addEventListener("click", function () {
        window.open("12_find.html", "_self");
    });
    const signup = document.querySelector("#signup");
    signup.addEventListener("click", function () {
        window.open("3_signup.html", "_self");
    });

    const login = document.querySelector("#login");
    login.addEventListener("click", function () {
        // 로그인 기능구현
        const userID = document.querySelector("#userID");
        const userPW = document.querySelector("#userPW");

        // // 회원가입 정보 JSON Object 로 관리하기
        // let data = {"User_no" : cnt++, "User_id" : userID.value, "User_pw" : userPW.value, "User_nickName" : "더미 데이터", "User_status" : "Y", "User_type" : "G"};
        // local.Users.push(data); // 회원가입한 유저 정보를 기존 localStorage에 저장, 현재 js 에서 처리함 = local 에 덮어쓰기
        // // console.log(local);

        // // 더미데이터를 활용해 추가된 User data 를 json 에 담기
        // // 이때 기존 admin 과 다른 User 정보는 유지됨
        // localStorage.setItem("Users", JSON.stringify(local));
        // // console.log(local.Users[0]); // admin 정보 확인
        // // console.log(local.Users[1]); // 추가된 user 1 정보 확인


        // 로그인 메소드 호출
        let result = signIn(userID.value, userPW.value);
        console.log(`로그인 결과값 : ${result}`)

        if (result == 0) { // 로그인 실패했을 경우
            alert("등록되지 않은 정보입니다.");
            userID.focus();

        } else if (result == 1) {                  // 로그인 성공했을 경우
            let loginData = getLoginAccount(); // 로그인된 계정 정보만 가져오기
            alert(`로그인 성공!\n ID : ${loginData.User_id}, PW : ${loginData.User_pw}`);
            window.history.back(); // 로그인 실행된 직전 페이지로 돌아가기

        } else if (result == 2) {
            let loginData = getLoginAccount();
            alert(`관리자 페이지로 진입합니다.`);
            window.open("10-1_admin_mainPage.html", "_self"); // 로그인 실행된 직전 페이지로 돌아가기
        } else if (result == 3) {
            alert("비활성화된 계정입니다.");
            window.location.reload();
        }
        // TODO 개발 완료되면 console.log 의 로그인 계정 정보 삭제하기
    });
















    const logoMain = document.querySelector("#logoMain");
    logoMain.addEventListener("click", function () {
        window.open("1_main.html", "_self");
    })



</script>

</html>